FROM ghcr.io/cross-rs/riscv64gc-unknown-linux-musl:main
RUN apt-get update && apt-get install -y \
      curl make perl pkg-config clang lld gcc-riscv64-linux-gnu libc6-dev-riscv64-cross libc6-riscv64-cross \
 && rm -rf /var/lib/apt/lists/*
RUN curl https://sh.rustup.rs -sSf | sh -s -- -y \
 && . "$HOME/.cargo/env" \
 && rustup target add riscv64gc-unknown-linux-musl
ENV PATH="/root/.cargo/bin:${PATH}"
WORKDIR /tmp
RUN curl -LO https://www.openssl.org/source/openssl-3.2.2.tar.gz \
 && tar xf openssl-3.2.2.tar.gz \
 && cd openssl-3.2.2 \
 && CC="riscv64-unknown-linux-musl-gcc" \
    ./Configure linux-generic64 no-shared no-tests no-async no-afalgeng \
      --prefix=/opt/openssl-riscv64 \
 && make -j$(nproc) V=1 install_sw \
 && rm -rf /tmp/*
